<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>GSAP Cross Reveal (Pinned Stack)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
      }
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans,
          sans-serif;
        background: #d6d2c4;
        color: #111;
      }

      .spacer {
        height: 80vh;
        display: grid;
        place-items: center;
      }

      /* 고정될 영역(가운데 박스) */
      .stage {
        position: relative;
        width: min(86vw, 1100px);
        margin: 0 auto;
        aspect-ratio: 16/9; /* 원하는 비율 */
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.18);
        overflow: hidden;
        background: #000;
      }

      /* 이미지 스택: 모두 동일한 자리에 절대 배치 */
      .stage img {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        will-change: transform;
        transform: translateY(0%); /* 위 이미지들은 여기서 0 → -100%로 이동 */
      }

      /* 첫 번째 이미지를 최상단, 그 다음은 그 아래… (DOM 순서 역순으로 z-index 부여) */
      .stage img:nth-child(1) {
        z-index: 4;
      }
      .stage img:nth-child(2) {
        z-index: 3;
      }
      .stage img:nth-child(3) {
        z-index: 2;
      }
      .stage img:nth-child(4) {
        z-index: 1;
      }
    </style>
  </head>
  <body>
    <div class="spacer"><h2>위 컨텐츠</h2></div>

    <!-- 핀되는 섹션(뷰포트 높이) -->
    <section
      class="pin-wrap"
      style="height: 100vh; display: grid; place-items: center"
    >
      <div class="stage" id="stage">
        <!-- 위에서부터(=최상단) 차례로 올라가며 사라지고, 아래가 드러남 -->
        <img src="https://picsum.photos/id/1015/1600/900" alt="img1" />
        <img src="https://picsum.photos/id/1025/1600/900" alt="img2" />
        <img src="https://picsum.photos/id/1035/1600/900" alt="img3" />
        <img src="https://picsum.photos/id/1043/1600/900" alt="img4" />
      </div>
    </section>

    <div class="spacer"><h2>아래 컨텐츠</h2></div>

    <script>
      gsap.registerPlugin(ScrollTrigger);

      const stage = document.getElementById('stage');
      const stack = gsap.utils.toArray('#stage img'); // [최상단, ..., 최하단]
      const steps = stack.length - 1; // 전환 횟수
      const distancePerStep = 1; // 타임라인 상 각 단계 길이(정규화)

      // 타임라인: pin 된 상태에서 스크롤에 따라 "윗 이미지"가 한 장씩 위로 빠짐
      const tl = gsap.timeline({
        defaults: { ease: 'none' },
        scrollTrigger: {
          trigger: '.pin-wrap',
          start: 'top top',
          end: '+=' + window.innerHeight * steps, // 이미지 n장이면 n-1 뷰포트 길이
          scrub: true,
          pin: true,
          anticipatePin: 1,
          snap: {
            // 단계(슬라이드) 경계로 스냅
            snapTo: (value) => {
              return Math.round(value * steps) / steps;
            },
            duration: 0.4,
            ease: 'power1.inOut',
          },
        },
      });

      // 각 단계: i번째(위) 이미지를 0 → -100%로 밀어 올려 아래 이미지를 드러냄
      stack.forEach((img, i) => {
        if (i === stack.length - 1) return; // 마지막(맨 아래)은 안 움직임
        tl.to(
          img,
          { yPercent: -100, duration: distancePerStep },
          i * distancePerStep
        );
      });

      // 리사이즈 대응
      window.addEventListener('resize', () => ScrollTrigger.refresh());
    </script>
  </body>
</html>
