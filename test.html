<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>GSAP Cross-Reveal + Swallow Overlay</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

    <!-- 데모용 폰트 -->
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@600&family=Noto+Serif+KR:wght@700&family=Playfair+Display:wght@700&family=Poppins:wght@700&display=swap"
      rel="stylesheet"
    />

    <style>
      * {
        box-sizing: border-box;
        margin: 0;
      }
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans,
          sans-serif;
        background: #d6d2c4;
        color: #111;
      }
      .spacer {
        height: 80vh;
        display: grid;
        place-items: center;
      }

      /* ----- 핀될 래퍼 ----- */
      .pin-wrap {
        position: relative; /* 오버레이 절대배치를 위한 기준 */
        height: 100vh;
        display: grid;
        place-items: center;
        overflow: clip; /* 오버레이 넘침 방지 */
      }

      /* 메인 내용(타이틀 + 이미지) */
      .inner {
        position: relative;
        width: min(86vw, 1100px);
        height: min(88vh, 900px);
        display: grid;
        grid-template-rows: auto 1fr; /* 타이틀 / 이미지 */
        gap: clamp(12px, 2.5vh, 28px);
        z-index: 1; /* 오버레이보다 아래 */
      }

      /* ----- 타이틀(폰트 페이드 교체) ----- */
      .typo {
        position: relative;
        height: clamp(60px, 16vh, 150px);
        overflow: hidden;
      }
      .title {
        position: absolute;
        inset: 0;
        display: grid;
        place-items: center;
        font-size: clamp(24px, 5.8vw, 60px);
        line-height: 1.08;
        text-align: center;
        letter-spacing: -0.02em;
        color: #1c1c1c;
        filter: drop-shadow(0 1px 0 rgba(255, 255, 255, 0.12));
        opacity: 0;
        will-change: opacity, transform;
      }
      .title.is-active {
        opacity: 1;
      }
      .font-1 {
        font-family: 'Noto Sans KR', 'Poppins', sans-serif;
      }
      .font-2 {
        font-family: 'Noto Serif KR', serif;
      }
      .font-3 {
        font-family: 'Playfair Display', serif;
      }
      .font-4 {
        font-family: 'Poppins', sans-serif;
      }

      /* ----- 이미지 스택(교차 전환) ----- */
      .stage {
        position: relative;
        width: 100%;
        aspect-ratio: 16/9;
        overflow: hidden;
        border-radius: 14px;
        background: #000;
        box-shadow: 0 12px 36px rgba(0, 0, 0, 0.18);
      }
      .stage img {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        will-change: transform;
        transform: translateY(0%);
      }
      .stage img:nth-child(1) {
        z-index: 4;
      }
      .stage img:nth-child(2) {
        z-index: 3;
      }
      .stage img:nth-child(3) {
        z-index: 2;
      }
      .stage img:nth-child(4) {
        z-index: 1;
      }

      /* ======= 오버레이(아래 컨텐츠가 올라와 삼킴) ======= */
      .swallow {
        position: absolute;
        left: 50%;
        bottom: 0;
        transform: translate(-50%, 110%); /* 화면 아래에서 대기 */
        width: min(86vw, 1100px);
        height: min(88vh, 900px); /* .inner와 동일 크기 → 완전 덮기 */
        border-radius: 14px;
        background: #f7f4ea; /* 사이트 톤에 맞게 */
        box-shadow: 0 -20px 60px rgba(0, 0, 0, 0.22);
        z-index: 5; /* .inner 위에 올라오도록 */
        overflow: hidden;
        will-change: transform;
      }
      .swallow .content {
        height: 100%;
        display: grid;
        grid-template-rows: auto 1fr;
        padding: clamp(18px, 2.6vh, 28px);
        gap: clamp(12px, 2vh, 20px);
      }
      .swallow h3 {
        font: 700 clamp(20px, 3.2vw, 36px) / 1.1 'Noto Serif KR', serif;
        margin: 0;
      }
      .swallow p {
        margin: 0;
        font-size: clamp(14px, 1.6vw, 16px);
        line-height: 1.55;
        opacity: 0.85;
      }

      /* 실제 다음 섹션 (핀 구간 이후 자연스럽게 이어지도록 동일한 비주얼을 배치) */
      .next {
        background: #f7f4ea;
        padding: clamp(28px, 6vw, 64px) 6vw;
      }
    </style>
  </head>
  <body>
    <div class="spacer"><h2>위 컨텐츠</h2></div>

    <section class="pin-wrap">
      <div class="inner">
        <!-- 타이틀(폰트 페이드) -->
        <div class="typo" id="typo">
          <h2 class="title font-1 is-active">World First Climate Control</h2>
          <h2 class="title font-2">World First Climate Control</h2>
          <h2 class="title font-3">World First Climate Control</h2>
          <h2 class="title font-4">World First Climate Control</h2>
        </div>

        <!-- 이미지 교차 전환 -->
        <div class="stage" id="stage">
          <img src="https://picsum.photos/id/1015/1600/900" alt="img1" />
          <img src="https://picsum.photos/id/1025/1600/900" alt="img2" />
          <img src="https://picsum.photos/id/1035/1600/900" alt="img3" />
          <img src="https://picsum.photos/id/1043/1600/900" alt="img4" />
        </div>
      </div>

      <!-- 오버레이: 아래 컨텐츠가 올라와 전체를 덮는 레이어 -->
      <aside class="swallow" id="swallow">
        <div class="content">
          <h3>Next: Adaptive Living Spaces</h3>
          <p>
            실내/실외 데이터를 통합 분석해 시간대·활동·재실 인원 변화를
            반영합니다. 스크롤이 끝나면 본문 섹션으로 자연스럽게 전환됩니다.
          </p>
          <div style="align-self: end; opacity: 0.7">Scroll to continue ↓</div>
        </div>
      </aside>
    </section>

    <!-- 실제 다음 섹션(오버레이와 동일 톤으로 이어짐) -->
    <section class="next">
      <h2
        style="
          font: 700 clamp(26px, 4.8vw, 48px) / 1.1 'Noto Serif KR', serif;
          margin: 0 0 16px;
        "
      >
        Adaptive Living Spaces
      </h2>
      <p style="max-width: 72ch; line-height: 1.7">
        이 영역은 실제 본문 섹션입니다. 위의 오버레이가 핀 구간 막바지에 올라와
        앨범을 완전히 덮고, 핀이 풀리면 자연스럽게 이 컨텐츠로 이어집니다.
      </p>
      <div style="height: 120vh"></div>
    </section>

    <script>
      gsap.registerPlugin(ScrollTrigger);

      const images = gsap.utils.toArray('#stage img'); // [최상단 → 최하단]
      const titles = gsap.utils.toArray('#typo .title'); // 이미지와 동일 개수
      const steps = images.length - 1; // 전환 횟수
      const seg = 1; // 각 전환 구간 길이
      const SPEED = 1.8; // 전체 스크롤 거리 배수(느리게)
      const SCRUB = 1.4; // 스크럽 관성

      // 초기 상태
      gsap.set(titles.slice(1), { autoAlpha: 0, y: 10 });

      const tl = gsap.timeline({
        defaults: { ease: 'none' },
        scrollTrigger: {
          trigger: '.pin-wrap',
          start: 'top top',
          end: '+=' + window.innerHeight * steps * SPEED,
          scrub: SCRUB,
          pin: true,
          anticipatePin: 1,
          snap: {
            snapTo: (v) => Math.round(v * steps) / steps, // 각 전환 경계에 스냅
            duration: 0.55,
            ease: 'power1.inOut',
          },
        },
      });

      // 1) 이미지 교차 + 타이틀 교체
      images.forEach((img, i) => {
        if (i === images.length - 1) return; // 마지막(바닥) 이미지는 고정
        const t = i * seg;

        // 윗장 들어 올리기
        tl.to(img, { yPercent: -100, duration: seg }, t);

        // 타이틀 페이드 교체
        tl.to(titles[i], { autoAlpha: 0, y: -10, duration: 0.35 }, t + 0.05).to(
          titles[i + 1],
          { autoAlpha: 1, y: 0, duration: 0.45 },
          t + 0.2
        );
      });

      // 2) 오버레이(아래 컨텐츠)가 올라와 전체를 '집어삼키는' 구간
      const swallowStart = Math.max(0, steps * seg - 0.8); // 마지막 전환 직전부터
      tl.fromTo(
        '#swallow',
        { yPercent: 110 },
        { yPercent: 0, duration: 0.8 },
        swallowStart
      );

      // 리사이즈 대응
      addEventListener('resize', () => ScrollTrigger.refresh());
    </script>
  </body>
</html>
